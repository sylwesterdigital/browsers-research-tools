<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Progressive Image Bench – 2025-10-16T17-58-33+01-00</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
  <style>
    :root { --card-min-h: 340px; }
    html, body { height: 100%; }
    body { font: 14px/1.4 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,system-ui; margin: 16px; }
    h1 { font-size: 20px; margin: 0 0 8px; }
    .grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
    .card { padding: 12px; border: 1px solid #e3e3e3; border-radius: 10px; background: #fff; }
    .plot { width: 100%; min-height: var(--card-min-h); }
    .table { border-collapse: collapse; width: 100%; font-size: 13px; }
    .table th, .table td { border-bottom: 1px solid #eee; padding: 6px 8px; text-align: left; }
    .small { color:#666; font-size:12px; }
    .kv { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:10px; }
    .kv div { background:#f7f7f7; border-radius:8px; padding:6px 8px; }
    @media (min-width: 1100px) { .grid { grid-template-columns: 1fr 1fr; } }
  </style>
</head>
<body>
  <h1>Progressive Image Bench – 2025-10-16T17-58-33+01-00</h1>
  <div class="small">Config: <code>bench.config.json</code></div>

  <div class="card" id="meta"></div>

  <div class="grid">
    <div class="card"><div id="bar_t85" class="plot"></div></div>
    <div class="card"><div id="bar_t95" class="plot"></div></div>
    <div class="card"><div id="bar_vi"  class="plot"></div></div>
    <div class="card"><div id="box_t85" class="plot"></div></div>
    <div class="card"><div id="box_t95" class="plot"></div></div>
    <div class="card"><div id="box_vi"  class="plot"></div></div>
    <div class="card">
      <table class="table" id="summary"></table>
    </div>
  </div>

  <script>
    const aggregated = [{"browser":"chromium","browser_version":"141.0.7390.37","id":"jpeg-baseline","label":"JPEG Baseline","format":"jpeg","notes":"","dist":{"count":2,"t85":[2337,2345],"t95":[2337,2345],"visIndex":[0.6022,0.5998]},"median":{"t85":2341,"t95":2341,"visIndex":0.601},"p10":{"t85":2337.8,"t95":2337.8,"visIndex":0.6000399999999999},"p90":{"t85":2344.2,"t95":2344.2,"visIndex":0.60196},"errors":[]},{"browser":"chromium","browser_version":"141.0.7390.37","id":"jpeg-progressive","label":"JPEG Progressive","format":"jpeg","notes":"","dist":{"count":2,"t85":[1323,1291],"t95":[1323,1291],"visIndex":[0.3475,0.3326]},"median":{"t85":1307,"t95":1307,"visIndex":0.34004999999999996},"p10":{"t85":1294.2,"t95":1294.2,"visIndex":0.33409},"p90":{"t85":1319.8,"t95":1319.8,"visIndex":0.34601},"errors":[]},{"browser":"chromium","browser_version":"141.0.7390.37","id":"webp","label":"WebP","format":"webp","notes":"","dist":{"count":2,"t85":[3374,3300],"t95":[3374,3300],"visIndex":[0.8049,0.7752]},"median":{"t85":3337,"t95":3337,"visIndex":0.7900499999999999},"p10":{"t85":3307.4,"t95":3307.4,"visIndex":0.77817},"p90":{"t85":3366.6,"t95":3366.6,"visIndex":0.80193},"errors":[]},{"browser":"chromium","browser_version":"141.0.7390.37","id":"avif","label":"AVIF","format":"avif","notes":"","dist":{"count":2,"t85":[2114,2126],"t95":[2114,2126],"visIndex":[0.717,0.717]},"median":{"t85":2120,"t95":2120,"visIndex":0.717},"p10":{"t85":2115.2000000000003,"t95":2115.2000000000003,"visIndex":0.717},"p90":{"t85":2124.8,"t95":2124.8,"visIndex":0.717},"errors":[]},{"browser":"chromium","browser_version":"141.0.7390.37","id":"avif-progressive","label":"AVIF (progressive)","format":"avif","notes":"single-input progressive","dist":{"count":2,"t85":[1311,1311],"t95":[1311,1311],"visIndex":[0.2521,0.2551]},"median":{"t85":1311,"t95":1311,"visIndex":0.2536},"p10":{"t85":1311,"t95":1311,"visIndex":0.2524},"p90":{"t85":1311,"t95":1311,"visIndex":0.25479999999999997},"errors":[]},{"browser":"chromium","browser_version":"141.0.7390.37","id":"jxl","label":"JPEG XL","format":"jxl","notes":"","dist":{"count":2,"t85":[350,357],"t95":[350,357],"visIndex":[0.0227,0.0226]},"median":{"t85":353.5,"t95":353.5,"visIndex":0.02265},"p10":{"t85":350.7,"t95":350.7,"visIndex":0.02261},"p90":{"t85":356.3,"t95":356.3,"visIndex":0.02269},"errors":[]},{"browser":"chromium","browser_version":"141.0.7390.37","id":"jxl-progressive","label":"JPEG XL (progressive)","format":"jxl","notes":"","dist":{"count":2,"t85":[360,357],"t95":[360,357],"visIndex":[0.0227,0.0225]},"median":{"t85":358.5,"t95":358.5,"visIndex":0.022600000000000002},"p10":{"t85":357.3,"t95":357.3,"visIndex":0.022520000000000002},"p90":{"t85":359.7,"t95":359.7,"visIndex":0.02268},"errors":[]},{"browser":"chromium","browser_version":"141.0.7390.37","id":"png-interlaced","label":"PNG (Adam7)","format":"png","notes":"","dist":{"count":2,"t85":[87,85],"t95":[87,85],"visIndex":[0,0]},"median":{"t85":86,"t95":86,"visIndex":0},"p10":{"t85":85.2,"t95":85.2,"visIndex":0},"p90":{"t85":86.8,"t95":86.8,"visIndex":0},"errors":[]},{"browser":"firefox","browser_version":"142.0.1","id":"jpeg-baseline","label":"JPEG Baseline","format":"jpeg","notes":"","dist":{"count":2,"t85":[778,161],"t95":[778,161],"visIndex":[0.4414,0]},"median":{"t85":469.5,"t95":469.5,"visIndex":0.2207},"p10":{"t85":222.70000000000002,"t95":222.70000000000002,"visIndex":0.044140000000000006},"p90":{"t85":716.3000000000001,"t95":716.3000000000001,"visIndex":0.39726},"errors":[]},{"browser":"firefox","browser_version":"142.0.1","id":"jpeg-progressive","label":"JPEG Progressive","format":"jpeg","notes":"","dist":{"count":2,"t85":[167,144],"t95":[167,144],"visIndex":[0.091,0]},"median":{"t85":155.5,"t95":155.5,"visIndex":0.0455},"p10":{"t85":146.29999999999998,"t95":146.29999999999998,"visIndex":0.0091},"p90":{"t85":164.70000000000002,"t95":164.70000000000002,"visIndex":0.0819},"errors":[]},{"browser":"firefox","browser_version":"142.0.1","id":"webp","label":"WebP","format":"webp","notes":"","dist":{"count":2,"t85":[776,146],"t95":[776,146],"visIndex":[0.4914,0]},"median":{"t85":461,"t95":461,"visIndex":0.2457},"p10":{"t85":209,"t95":209,"visIndex":0.04914},"p90":{"t85":713,"t95":713,"visIndex":0.44226},"errors":[]},{"browser":"firefox","browser_version":"142.0.1","id":"avif","label":"AVIF","format":"avif","notes":"","dist":{"count":2,"t85":[733,147],"t95":[733,147],"visIndex":[0.4087,0]},"median":{"t85":440,"t95":440,"visIndex":0.20435},"p10":{"t85":205.60000000000002,"t95":205.60000000000002,"visIndex":0.040870000000000004},"p90":{"t85":674.4000000000001,"t95":674.4000000000001,"visIndex":0.36783},"errors":[]},{"browser":"firefox","browser_version":"142.0.1","id":"avif-progressive","label":"AVIF (progressive)","format":"avif","notes":"single-input progressive","dist":{"count":2,"t85":[1706,150],"t95":[1706,150],"visIndex":[0.6963,0]},"median":{"t85":928,"t95":928,"visIndex":0.34815},"p10":{"t85":305.6,"t95":305.6,"visIndex":0.06963000000000001},"p90":{"t85":1550.4,"t95":1550.4,"visIndex":0.6266700000000001},"errors":[]},{"browser":"firefox","browser_version":"142.0.1","id":"jxl","label":"JPEG XL","format":"jxl","notes":"","dist":{"count":2,"t85":[60,76],"t95":[60,76],"visIndex":[0,0]},"median":{"t85":68,"t95":68,"visIndex":0},"p10":{"t85":61.6,"t95":61.6,"visIndex":0},"p90":{"t85":74.4,"t95":74.4,"visIndex":0},"errors":[]},{"browser":"firefox","browser_version":"142.0.1","id":"jxl-progressive","label":"JPEG XL (progressive)","format":"jxl","notes":"","dist":{"count":2,"t85":[75,73],"t95":[75,73],"visIndex":[0,0]},"median":{"t85":74,"t95":74,"visIndex":0},"p10":{"t85":73.2,"t95":73.2,"visIndex":0},"p90":{"t85":74.8,"t95":74.8,"visIndex":0},"errors":[]},{"browser":"firefox","browser_version":"142.0.1","id":"png-interlaced","label":"PNG (Adam7)","format":"png","notes":"","dist":{"count":2,"t85":[6064,159],"t95":[6064,159],"visIndex":[0.506,0]},"median":{"t85":3111.5,"t95":3111.5,"visIndex":0.253},"p10":{"t85":749.5,"t95":749.5,"visIndex":0.050600000000000006},"p90":{"t85":5473.5,"t95":5473.5,"visIndex":0.4554},"errors":[]},{"browser":"webkit","browser_version":"26.0","id":"jpeg-baseline","label":"JPEG Baseline","format":"jpeg","notes":"","dist":{"count":2,"t85":[1265,130],"t95":[1265,130],"visIndex":[0.6069,0]},"median":{"t85":697.5,"t95":697.5,"visIndex":0.30345},"p10":{"t85":243.5,"t95":243.5,"visIndex":0.06069},"p90":{"t85":1151.5,"t95":1151.5,"visIndex":0.54621},"errors":[]},{"browser":"webkit","browser_version":"26.0","id":"jpeg-progressive","label":"JPEG Progressive","format":"jpeg","notes":"","dist":{"count":2,"t85":[616,135],"t95":[616,135],"visIndex":[0.4328,0]},"median":{"t85":375.5,"t95":375.5,"visIndex":0.2164},"p10":{"t85":183.1,"t95":183.1,"visIndex":0.043280000000000006},"p90":{"t85":567.9,"t95":567.9,"visIndex":0.38952000000000003},"errors":[]},{"browser":"webkit","browser_version":"26.0","id":"webp","label":"WebP","format":"webp","notes":"","dist":{"count":2,"t85":[1413,132],"t95":[1413,132],"visIndex":[0.641,0]},"median":{"t85":772.5,"t95":772.5,"visIndex":0.3205},"p10":{"t85":260.1,"t95":260.1,"visIndex":0.0641},"p90":{"t85":1284.9,"t95":1284.9,"visIndex":0.5769000000000001},"errors":[]},{"browser":"webkit","browser_version":"26.0","id":"avif","label":"AVIF","format":"avif","notes":"","dist":{"count":2,"t85":[709,138],"t95":[709,138],"visIndex":[0.4588,0]},"median":{"t85":423.5,"t95":423.5,"visIndex":0.2294},"p10":{"t85":195.10000000000002,"t95":195.10000000000002,"visIndex":0.045880000000000004},"p90":{"t85":651.9,"t95":651.9,"visIndex":0.41292},"errors":[]},{"browser":"webkit","browser_version":"26.0","id":"avif-progressive","label":"AVIF (progressive)","format":"avif","notes":"single-input progressive","dist":{"count":2,"t85":[1639,132],"t95":[1639,132],"visIndex":[0.6748,0]},"median":{"t85":885.5,"t95":885.5,"visIndex":0.3374},"p10":{"t85":282.7,"t95":282.7,"visIndex":0.06748},"p90":{"t85":1488.3000000000002,"t95":1488.3000000000002,"visIndex":0.60732},"errors":[]},{"browser":"webkit","browser_version":"26.0","id":"jxl","label":"JPEG XL","format":"jxl","notes":"","dist":{"count":2,"t85":[776,107],"t95":[776,107],"visIndex":[0.4904,0]},"median":{"t85":441.5,"t95":441.5,"visIndex":0.2452},"p10":{"t85":173.9,"t95":173.9,"visIndex":0.04904},"p90":{"t85":709.1,"t95":709.1,"visIndex":0.44136000000000003},"errors":[]},{"browser":"webkit","browser_version":"26.0","id":"jxl-progressive","label":"JPEG XL (progressive)","format":"jxl","notes":"","dist":{"count":2,"t85":[765,113],"t95":[765,113],"visIndex":[0.4872,0]},"median":{"t85":439,"t95":439,"visIndex":0.2436},"p10":{"t85":178.2,"t95":178.2,"visIndex":0.048720000000000006},"p90":{"t85":699.8,"t95":699.8,"visIndex":0.43848000000000004},"errors":[]},{"browser":"webkit","browser_version":"26.0","id":"png-interlaced","label":"PNG (Adam7)","format":"png","notes":"","dist":{"count":2,"t85":[11007,88],"t95":[11007,88],"visIndex":[0.92,0]},"median":{"t85":5547.5,"t95":5547.5,"visIndex":0.46},"p10":{"t85":1179.9,"t95":1179.9,"visIndex":0.09200000000000001},"p90":{"t85":9915.1,"t95":9915.1,"visIndex":0.8280000000000001},"errors":[]}];
    const meta = {"system":{"os_type":"Darwin","os_platform":"darwin","os_release":"24.1.0","os_arch":"arm64","cpu_model":"Apple M2 Pro","cpu_cores":12,"memory_gb":17},"node":"v20.19.4","versions":{"chromium":"141.0.7390.37","firefox":"142.0.1","webkit":"26.0"},"runs":2};
    const testOrder = [...new Set(aggregated.map(r => r.id))];

    function renderMeta() {
      const m = document.getElementById('meta');
      const sys = meta.system;
      const vers = meta.versions;
      const osLine = sys.os_type + " " + sys.os_release + " (" + sys.os_platform + ", " + sys.os_arch + ")";
      const hwLine = sys.cpu_model + " ×" + sys.cpu_cores + " • " + sys.memory_gb + " GB RAM";
      const nodeLine = "Node " + meta.node + (meta.runs ? " • runs=" + meta.runs : "");
      const browsers = Object.entries(vers).map(([k,v]) => k + ": " + v).join(" • ");
      m.innerHTML = '<div class="kv">'
      + '<div><b>OS</b>: ' + osLine + '</div>'
      + '<div><b>HW</b>: ' + hwLine + '</div>'
      + '<div><b>Node</b>: ' + nodeLine + '</div>'
      + '<div><b>Browsers</b>: ' + browsers + '</div>'
      + '</div>';
    }

/* -------- Grouped BAR charts (exactly three bars per test) -------- */
    function barsFor(metricKey, elId, title, yTitle, isFloat=false) {
      const browsers = [...new Set(aggregated.map(r => r.browser))];
      const traces = browsers.map(b => {
        const rows = aggregated.filter(r => r.browser === b);
        const y = testOrder.map(id => {
          const row = rows.find(r => r.id === id);
          const v = row?.median?.[metricKey];
          if (v==null || Number.isNaN(Number(v))) return null;
          return isFloat ? Number(v) : Math.round(Number(v));
        });
        return {
          x: testOrder,
          y,
          name: b,
          type: 'bar',
          offsetgroup: b,
          hovertemplate: 'Browser: ' + b + '<br>Test: %{x}<br>' + title + ': %{y}' + (isFloat ? '' : ' ms') + '<extra></extra>'
        };
      });
      const layout = {
        title,
        barmode:'group',
        bargap: 0.15,
        bargroupgap: 0.08,
        xaxis:{ title:'Test', categoryarray: testOrder, categoryorder:'array' },
        yaxis:{ title:yTitle, rangemode:'tozero', tickformat: isFloat ? '.3f' : undefined },
        margin:{ t:40, r:10, b:60, l:50 }
      };
      Plotly.newPlot(elId, traces, layout, {displaylogo:false, responsive:true, useResizeHandler:true});
    }

/* ---------------- Box-plots for full run distributions ----------------
 * FIX: Explicitly create a separate box trace PER (browser, testId) pair.
 *      This guarantees three side-by-side boxes for each category (no overlap).
 */


/* ---------------- Box-plots for full run distributions (clarified) ---------
 * One trace per browser; 3 boxes per test, side-by-side (no overlap).
 * Adds median notch, mean marker, and a y=0 zeroline for orientation.
 */
    function boxPlot(metric, elId, title) {
      const browsers = [...new Set(aggregated.map(r => r.browser))];

      const traces = browsers.map(b => {
        const rows = aggregated.filter(r => r.browser === b);

        const x = [];
        const y = [];
        for (const id of testOrder) {
          const row = rows.find(r => r.id === id);
          const vals = (row && row.dist && row.dist[metric]) ? row.dist[metric] : [];
          for (let i = 0; i < vals.length; i++) {
            x.push(id);
            y.push(vals[i]);
          }
        }

        return {
          x,
          y,
          name: b,
          type: 'box',
          boxpoints: 'outliers',
      notched: true,           // show 95% CI around the median
      boxmean: true,           // show a marker for the mean
      whiskerwidth: 0.5,
      offsetgroup: b,
      legendgroup: b,
      showlegend: true,
      hovertemplate: 'Browser: ' + b + '<br>Test: %{x}<br>' + metric + ': %{y}<extra></extra>'
    };
  });

      const isVI = metric === 'visIndex';
      Plotly.newPlot(elId, traces, {
        title,
        boxmode: 'group',
        xaxis: {
          title: 'Test ID',
          type: 'category',
          categoryarray: testOrder,
          categoryorder: 'array',
          automargin: true
        },
        yaxis: {
          title: isVI ? 'index' : 'ms',
          rangemode: 'tozero',
          zeroline: true,
          tickformat: isVI ? '.3f' : undefined
        },
        margin: { t: 40, r: 10, b: 60, l: 60 }
      }, { displaylogo: false, responsive: true, useResizeHandler: true });
    }


    function drawTable() {
      const headers = ["browser","browser_version","id","label","format",
       "median_t85","p10_t85","p90_t85",
       "median_t95","p10_t95","p90_t95",
       "median_visIndex","p10_visIndex","p90_visIndex",
       "notes","n_runs","errors"];
       const tbl = document.getElementById('summary');
       const thead = document.createElement('thead'); const trh = document.createElement('tr');
       headers.forEach(h => { const th = document.createElement('th'); th.textContent = h; trh.appendChild(th); });
       thead.appendChild(trh);
       const tbody = document.createElement('tbody');

       const byBrowser = {};
       aggregated.forEach(r => { (byBrowser[r.browser] ||= []).push(r); });
       Object.keys(byBrowser).sort().forEach(b => {
        const rows = byBrowser[b].slice().sort((a,b) => testOrder.indexOf(a.id) - testOrder.indexOf(b.id));
        rows.forEach(r => {
          const tr = document.createElement('tr');
          const row = [
            r.browser, r.browser_version, r.id, r.label, r.format,
            round(r.median.t85), round(r.p10.t85), round(r.p90.t85),
            round(r.median.t95), round(r.p10.t95), round(r.p90.t95),
            fmt3(r.median.visIndex), fmt3(r.p10.visIndex), fmt3(r.p90.visIndex),
            r.notes || "", r.dist.count, (r.errors||[]).join(" | ")
          ];
          row.forEach(v => { const td = document.createElement('td'); td.textContent = v ?? ""; tr.appendChild(td); });
          tbody.appendChild(tr);
        });
      });

       tbl.appendChild(thead); tbl.appendChild(tbody);

       function round(v){ return (v==null||isNaN(v)) ? "" : Math.round(v); }
       function fmt3(v){ return (v==null||isNaN(v)) ? "" : (+v).toFixed(3); }
     }

     function attachResize() {
      const ids = ['bar_t85','bar_t95','bar_vi','box_t85','box_t95','box_vi'];
      window.addEventListener('resize', () => { ids.forEach(id => { const el = document.getElementById(id); if (el) Plotly.Plots.resize(el); }); });
    }

/* --------- Render all charts --------- */
    renderMeta();
    barsFor('t85', 'bar_t85', 'Time to 85% (median)', 'ms', false);
    barsFor('t95', 'bar_t95', 'Time to 95% (median)', 'ms', false);
    barsFor('visIndex', 'bar_vi', 'Visual Index (median, lower is better)', 'index', true);
    boxPlot('t85', 'box_t85', 't85 distribution (lower is better)');
    boxPlot('t95', 'box_t95', 't95 distribution (lower is better)');
    boxPlot('visIndex', 'box_vi', 'Visual Index distribution (lower is better)');
    drawTable();
    attachResize();
  </script>
</body>
</html>